# Todo App 后端详细设计文档

## 概述
本设计文档详细描述 Todo App 后端的模块、数据库设计、接口定义及实现细节。后端采用 NestJS 框架，结合 MySQL 作为数据库，Redis 作为缓存。

## 技术栈
- **框架**：NestJS
- **语言**：TypeScript
- **数据库**：MySQL
- **缓存**：Redis
- **ORM**：TypeORM
- **认证**：JWT（JSON Web Token）

## 模块设计

### 用户管理模块
#### 1. 用户注册
- **路径**：`POST /api/auth/register`
- **功能**：用户注册，保存用户信息。
- **实现**：
  - 接收用户名、邮箱、密码。
  - 对密码进行哈希加密（使用 bcrypt）。
  - 保存用户信息到数据库。
  - 返回用户信息（不包括密码）。

#### 2. 用户登录
- **路径**：`POST /api/auth/login`
- **功能**：用户登录，生成 JWT。
- **实现**：
  - 接收邮箱和密码。
  - 验证用户信息。
  - 生成 JWT，返回给客户端。

#### 3. 获取用户信息
- **路径**：`GET /api/auth/me`
- **功能**：获取当前登录用户的信息。
- **实现**：
  - 验证 JWT。
  - 返回用户信息。

### 任务管理模块
#### 1. 创建任务
- **路径**：`POST /api/tasks`
- **功能**：创建新任务。
- **实现**：
  - 接收任务标题、描述、开始时间、截止时间等。
  - 保存任务信息到数据库。
  - 返回任务信息。

#### 2. 获取任务列表
- **路径**：`GET /api/tasks`
- **功能**：获取当前用户的任务列表。
- **实现**：
  - 验证用户身份。
  - 查询数据库获取用户任务列表。
  - 返回任务列表。

#### 3. 获取任务详情
- **路径**：`GET /api/tasks/:id`
- **功能**：获取任务的详细信息。
- **实现**：
  - 验证用户身份。
  - 查询数据库获取任务详情。
  - 返回任务详情。

#### 4. 更新任务
- **路径**：`PUT /api/tasks/:id`
- **功能**：更新任务信息。
- **实现**：
  - 验证用户身份。
  - 接收更新信息，更新数据库。
  - 返回更新后的任务信息。

#### 5. 删除任务
- **路径**：`DELETE /api/tasks/:id`
- **功能**：删除任务。
- **实现**：
  - 验证用户身份。
  - 删除数据库中的任务。
  - 返回删除成功的信息。

### 标签管理模块
#### 1. 创建标签
- **路径**：`POST /api/tags`
- **功能**：创建新标签。
- **实现**：
  - 接收标签名称。
  - 保存标签信息到数据库。
  - 返回标签信息。

#### 2. 获取标签列表
- **路径**：`GET /api/tags`
- **功能**：获取当前用户的标签列表。
- **实现**：
  - 验证用户身份。
  - 查询数据库获取用户标签列表。
  - 返回标签列表。

#### 3. 更新标签
- **路径**：`PUT /api/tags/:id`
- **功能**：更新标签信息。
- **实现**：
  - 验证用户身份。
  - 接收更新信息，更新数据库。
  - 返回更新后的标签信息。

#### 4. 删除标签
- **路径**：`DELETE /api/tags/:id`
- **功能**：删除标签。
- **实现**：
  - 验证用户身份。
  - 删除数据库中的标签。
  - 返回删除成功的信息。

### 提醒管理模块
#### 1. 创建提醒
- **路径**：`POST /api/reminders`
- **功能**：创建新提醒。
- **实现**：
  - 接收提醒时间和提醒方式。
  - 保存提醒信息到数据库。
  - 返回提醒信息。

#### 2. 获取提醒列表
- **路径**：`GET /api/reminders`
- **功能**：获取当前用户的提醒列表。
- **实现**：
  - 验证用户身份。
  - 查询数据库获取用户提醒列表。
  - 返回提醒列表。

#### 3. 更新提醒
- **路径**：`PUT /api/reminders/:id`
- **功能**：更新提醒信息。
- **实现**：
  - 验证用户身份。
  - 接收更新信息，更新数据库。
  - 返回更新后的提醒信息。

#### 4. 删除提醒
- **路径**：`DELETE /api/reminders/:id`
- **功能**：删除提醒。
- **实现**：
  - 验证用户身份。
  - 删除数据库中的提醒。
  - 返回删除成功的信息。

## 数据库设计

### 表结构
1. **用户表（users）**
    - id（主键）
    - username（用户名）
    - email（邮箱）
    - password（密码，经过哈希加密）
    - created_at（创建时间）
    - updated_at（更新时间）

2. **任务表（tasks）**
    - id（主键）
    - user_id（外键，关联用户表）
    - title（任务标题）
    - description（任务描述）
    - start_time（任务开始时间）
    - end_time（任务截止时间）
    - is_completed（是否完成）
    - created_at（创建时间）
    - updated_at（更新时间）

3. **标签表（tags）**
    - id（主键）
    - user_id（外键，关联用户表）
    - name（标签名）
    - created_at（创建时间）
    - updated_at（更新时间）

4. **任务标签关联表（task_tags）**
    - task_id（外键，关联任务表）
    - tag_id（外键，关联标签表）

5. **提醒表（reminders）**
    - id（主键）
    - task_id（外键，关联任务表）
    - reminder_time（提醒时间）
    - method（提醒方式，如邮件、短信、推送通知）

## 缓存设计
- **用户会话信息**：使用 Redis 存储用户会话信息，减少数据库查询压力。
- **任务列表缓存**：缓存用户的任务列表，提高查询效率。
- **提醒任务缓存**：缓存即将到来的提醒任务，便于及时通知。

## 安全设计
- **用户认证和授权**：使用 JWT 进行用户认证和授权，确保接口安全。
- **数据传输加密**：所有敏感数据传输使用 HTTPS 加密。
- **敏感信息管理**：数据库密码和密钥等敏感信息使用环境变量管理。

## 接口实现

### 用户管理接口
- **注册**：使用 `AuthService` 的 `register` 方法。
- **登录**：使用 `AuthService` 的 `login` 方法，生成 JWT。
- **获取用户信息**：使用 `UserService` 的 `getUserById` 方法，根据 JWT 中的用户 ID 获取用户信息。

### 任务管理接口
- **创建任务**：使用 `TaskService` 的 `createTask` 方法，保存任务信息到数据库。
- **获取任务列表**：使用 `TaskService` 的 `getTasksByUserId` 方法，查询数据库获取任务列表。
- **获取任务详情**：使用 `TaskService` 的 `getTaskById` 方法，查询数据库获取任务详情。
- **更新任务**：使用 `TaskService` 的 `updateTask` 方法，更新任务信息。
- **删除任务**：使用 `TaskService` 的 `deleteTask` 方法，删除数据库中的任务。

### 标签管理接口
- **创建标签**：使用 `TagService` 的 `createTag` 方法，保存标签信息到数据库。
- **获取标签列表**：使用 `TagService` 的 `getTagsByUserId` 方法，查询数据库获取标签列表。
- **更新标签**：使用 `TagService` 的 `updateTag` 方法，更新标签信息。
- **删除标签**：使用 `TagService` 的 `deleteTag` 方法，删除数据库中的标签。

### 提醒管理接口
- **创建提醒**：使用 `ReminderService` 的 `createReminder` 方法，保存提醒信息到数据库。
- **获取提醒列表**：使用 `ReminderService` 的 `getRemindersByUserId` 方法，查询数据库获取提醒列表。
- **更新提醒**：使用 `ReminderService` 的 `updateReminder` 方法，更新提醒信息。
- **删除提醒**：使用 `ReminderService` 的 `deleteReminder` 方法，删除数据库中的提醒。

## 定时任务设计
- 使用 NestJS 的 `@nestjs/schedule` 模块或 Bull 库进行定时任务调度。
- 定时检查即将到来的提醒任务，并发送通知（邮件、短信或推送通知）。

## 性能优化
- 使用 Redis 缓存，减少数据库查询压力。
- 数据库查询使用索引，提高查询效率。
- 异步处理耗时操作，如发送提醒通知。

---

老表，这详细设计文档一出，后端的架构就清清楚楚了。按着这个文档去实现，妥妥的。如果有啥问题，随时问，哥们儿给你撑腰到底！
